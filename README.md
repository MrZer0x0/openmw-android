
# OpenMW для Android 

## версия от OTF
[Telegram](https://t.me/morrowind24)


(благодарим за конструктор и труды
sandstranger, xyzz и sisah)

## Сборка

Существует два этапа для сборки OpenMW для Android. Первый этап - это сборка C/C++ библиотек. Второй этап - сборка Java-загрузчика.

### Предварительные условия

Вам понадобятся некоторые стандартные инструменты, которые, вероятно, уже установлены (bash, gcc, g++, sha256sum, unzip).

CMake 3.6.0 или новее **обязателен**, вы можете загрузить последнюю версию [здесь](https://cmake.org/download/) (и поместить в вашу `PATH`), если ваша дистрибуция поставляется со старой версией.

Кроме того, для сборки загрузчика вам понадобится установленный Android SDK, рекомендуется использовать Android Studio, которая может настроить его для вас (см. шаг 2).

### Шаг 1: Сборка библиотек

Перейдите в каталог `buildscripts` и выполните `./build.sh`. Скрипт автоматически загрузит Android native toolchain и все зависимости, а также скомпилирует и установит их.

### Шаг 2: Сборка Java-загрузчика

Чтобы получить файл APK, который вы можете установить, откройте каталог `openmw-android` в Android Studio и запустите проект.

В качестве альтернативы, если у вас не установлена Android Studio или вы не хотите ее использовать, выполните `./gradlew assembleDebug` из корневого каталога этого репозитория. Полученный APK, расположенный по адресу `./app/build/outputs/apk/debug/app-debug.apk`, можно перенести на устройство и установить.

## Примечания для разработчиков

### Отладка нативного кода

Вы можете отлаживать нативный код с помощью `ndk-gdb`. Чтобы использовать его, после сбора библиотек и APK и установки APK запустите приложение и оставьте его на главном меню. Затем выполните `cd` в `app/src/main` и запустите `./gdb.sh [arch]`. Переменная `arch` должна соответствовать библиотеке, которую будет использовать ваше устройство (одна из `arm`, `arm64`, `x86_64`, `x86`; по умолчанию используется `arm`).

Это также автоматически включает gdb для использования неочищенных библиотек, так что вы получите правильные символы, ссылки на исходный код и т.д.

### Запуск Address Sanitizer

Чтобы скомпилировать всё с ASAN:

```
# Очистить предыдущую сборку
./clean.sh
# Сборка с включенным ASAN и символами отладки
./build.sh --ccache --asan --debug
# Или: ./build.sh --ccache --asan --debug --arch arm64
```

Затем откройте Android Studio и скомпилируйте и установите проект.

Чтобы получить символизированный вывод:

```
adb logcat | ./tool/asan_symbolize.py --demangle -s ./symbols/armeabi-v7a/
# Или: adb logcat | ./tool/asan_symbolize.py --demangle -s ./symbols/arm64-v8a/
```

## Спасибо

### Исходный код

Оригинальный Java-код написан sandstranger. Скрипты сборки изначально написаны sandstranger и bwhaines.
